<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile System Test - Phase 4 Session 1</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        .test-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .test-button:hover {
            background: #5a67d8;
        }
        .result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #b7e3ec;
        }
        .component-test {
            display: none;
            margin-top: 20px;
            padding: 20px;
            border: 2px solid #667eea;
            border-radius: 8px;
        }
        .component-test.active {
            display: block;
        }
        .achievement-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .achievement-icon {
            width: 50px;
            height: 50px;
            background: #667eea;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
        }
        .chart-container {
            width: 100%;
            height: 300px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-user-circle"></i> Profile System Test Suite</h1>
            <p>Phase 4, Session 1 - User Profile System Implementation</p>
        </div>

        <div class="test-section">
            <h3><i class="fas fa-cogs"></i> Component Loading Tests</h3>
            <button class="test-button" onclick="testComponentLoading()">Test Component Loading</button>
            <button class="test-button" onclick="testProfileManager()">Test Profile Manager</button>
            <button class="test-button" onclick="testAchievementSystem()">Test Achievement System</button>
            <button class="test-button" onclick="testProgressVisualization()">Test Progress Visualization</button>
            <div id="component-results" class="result"></div>
        </div>

        <div class="test-section">
            <h3><i class="fas fa-trophy"></i> Achievement System Demo</h3>
            <button class="test-button" onclick="showAchievementDemo()">Show Achievement Demo</button>
            <button class="test-button" onclick="testAchievementNotification()">Test Notification</button>
            <div id="achievement-demo" class="component-test">
                <h4>Sample Achievements</h4>
                <div class="achievement-card">
                    <div class="achievement-icon"><i class="fas fa-star"></i></div>
                    <div>
                        <h5>First Steps</h5>
                        <p>Complete your first lesson</p>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 100%"></div>
                        </div>
                    </div>
                </div>
                <div class="achievement-card">
                    <div class="achievement-icon"><i class="fas fa-code"></i></div>
                    <div>
                        <h5>Code Runner</h5>
                        <p>Execute code 10 times</p>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 80%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h3><i class="fas fa-chart-line"></i> Progress Visualization Demo</h3>
            <button class="test-button" onclick="showProgressDemo()">Show Progress Demo</button>
            <button class="test-button" onclick="testChartRendering()">Test Chart Rendering</button>
            <div id="progress-demo" class="component-test">
                <h4>Learning Progress</h4>
                <div class="chart-container">
                    <div>
                        <i class="fas fa-chart-line" style="font-size: 48px; color: #667eea;"></i>
                        <p>Chart would render here with Chart.js</p>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #667eea;">15</div>
                        <div>Lessons Completed</div>
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #667eea;">5</div>
                        <div>Achievements</div>
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #667eea;">3</div>
                        <div>Day Streak</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h3><i class="fas fa-server"></i> API Endpoint Tests</h3>
            <button class="test-button" onclick="testApiEndpoints()">Test All API Endpoints</button>
            <button class="test-button" onclick="testProfileApi()">Test Profile API</button>
            <button class="test-button" onclick="testAchievementsApi()">Test Achievements API</button>
            <button class="test-button" onclick="testStatsApi()">Test Stats API</button>
            <div id="api-results" class="result"></div>
        </div>

        <div class="test-section">
            <h3><i class="fas fa-mobile-alt"></i> Responsive Design Test</h3>
            <button class="test-button" onclick="testResponsiveDesign()">Test Responsive Design</button>
            <button class="test-button" onclick="simulateMobile()">Simulate Mobile View</button>
            <button class="test-button" onclick="simulateDesktop()">Simulate Desktop View</button>
            <div id="responsive-results" class="result"></div>
        </div>

        <div class="test-section">
            <h3><i class="fas fa-link"></i> Navigation Tests</h3>
            <button class="test-button" onclick="testNavigationLinks()">Test Navigation Links</button>
            <button class="test-button" onclick="openProfilePage()">Open Profile Page</button>
            <button class="test-button" onclick="openMainTest()">Open Main Test Page</button>
            <div id="navigation-results" class="result"></div>
        </div>

        <div class="test-section">
            <h3><i class="fas fa-check-circle"></i> Complete System Test</h3>
            <button class="test-button" onclick="runAllTests()">Run All Tests</button>
            <button class="test-button" onclick="generateTestReport()">Generate Test Report</button>
            <div id="complete-results" class="result"></div>
        </div>
    </div>

    <!-- Load the profile components -->
    <script src="/static/js/profile/ProfileManager.js"></script>
    <script src="/static/js/profile/AchievementSystem.js"></script>
    <script src="/static/js/profile/ProgressVisualization.js"></script>

    <script>
        // Test results storage
        let testResults = [];

        function logResult(test, result, type = 'info') {
            const timestamp = new Date().toISOString();
            testResults.push({ test, result, type, timestamp });
            console.log(`[${timestamp}] ${test}: ${result}`);
        }

        function displayResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="${type}">${message}</div>`;
            element.style.display = 'block';
        }

        // Component Loading Tests
        function testComponentLoading() {
            let results = [];
            
            // Test if components are loaded
            if (typeof ProfileManager !== 'undefined') {
                results.push('‚úÖ ProfileManager loaded successfully');
                logResult('ProfileManager', 'Loaded', 'success');
            } else {
                results.push('‚ùå ProfileManager not found');
                logResult('ProfileManager', 'Not found', 'error');
            }
            
            if (typeof AchievementSystem !== 'undefined') {
                results.push('‚úÖ AchievementSystem loaded successfully');
                logResult('AchievementSystem', 'Loaded', 'success');
            } else {
                results.push('‚ùå AchievementSystem not found');
                logResult('AchievementSystem', 'Not found', 'error');
            }
            
            if (typeof ProgressVisualization !== 'undefined') {
                results.push('‚úÖ ProgressVisualization loaded successfully');
                logResult('ProgressVisualization', 'Loaded', 'success');
            } else {
                results.push('‚ùå ProgressVisualization not found');
                logResult('ProgressVisualization', 'Not found', 'error');
            }
            
            displayResult('component-results', results.join('<br>'), 'info');
        }

        function testProfileManager() {
            try {
                const profileManager = new ProfileManager();
                displayResult('component-results', '‚úÖ ProfileManager instantiated successfully', 'success');
                logResult('ProfileManager Instantiation', 'Success', 'success');
            } catch (error) {
                displayResult('component-results', `‚ùå ProfileManager instantiation failed: ${error.message}`, 'error');
                logResult('ProfileManager Instantiation', error.message, 'error');
            }
        }

        function testAchievementSystem() {
            try {
                const achievementSystem = new AchievementSystem();
                displayResult('component-results', '‚úÖ AchievementSystem instantiated successfully', 'success');
                logResult('AchievementSystem Instantiation', 'Success', 'success');
            } catch (error) {
                displayResult('component-results', `‚ùå AchievementSystem instantiation failed: ${error.message}`, 'error');
                logResult('AchievementSystem Instantiation', error.message, 'error');
            }
        }

        function testProgressVisualization() {
            try {
                const progressViz = new ProgressVisualization();
                displayResult('component-results', '‚úÖ ProgressVisualization instantiated successfully', 'success');
                logResult('ProgressVisualization Instantiation', 'Success', 'success');
            } catch (error) {
                displayResult('component-results', `‚ùå ProgressVisualization instantiation failed: ${error.message}`, 'error');
                logResult('ProgressVisualization Instantiation', error.message, 'error');
            }
        }

        // Achievement System Demo
        function showAchievementDemo() {
            const demo = document.getElementById('achievement-demo');
            demo.classList.toggle('active');
            
            if (demo.classList.contains('active')) {
                displayResult('component-results', '‚úÖ Achievement demo displayed', 'success');
                logResult('Achievement Demo', 'Displayed', 'success');
            }
        }

        function testAchievementNotification() {
            try {
                if (typeof AchievementSystem !== 'undefined') {
                    const achievementSystem = new AchievementSystem();
                    const mockAchievement = {
                        id: 'test_achievement',
                        name: 'Test Achievement',
                        description: 'This is a test achievement notification',
                        icon: 'star'
                    };
                    achievementSystem.showNotification(mockAchievement);
                    displayResult('component-results', '‚úÖ Achievement notification displayed', 'success');
                    logResult('Achievement Notification', 'Success', 'success');
                } else {
                    throw new Error('AchievementSystem not available');
                }
            } catch (error) {
                displayResult('component-results', `‚ùå Achievement notification failed: ${error.message}`, 'error');
                logResult('Achievement Notification', error.message, 'error');
            }
        }

        // Progress Visualization Demo
        function showProgressDemo() {
            const demo = document.getElementById('progress-demo');
            demo.classList.toggle('active');
            
            if (demo.classList.contains('active')) {
                displayResult('component-results', '‚úÖ Progress demo displayed', 'success');
                logResult('Progress Demo', 'Displayed', 'success');
            }
        }

        function testChartRendering() {
            displayResult('component-results', '‚úÖ Chart rendering test completed (Chart.js integration would be tested in full environment)', 'success');
            logResult('Chart Rendering', 'Test completed', 'success');
        }

        // API Endpoint Tests
        async function testApiEndpoints() {
            const endpoints = [
                '/api/profile/',
                '/api/profile/stats',
                '/api/profile/achievements',
                '/api/profile/activity',
                '/api/profile/settings'
            ];
            
            let results = [];
            
            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(endpoint);
                    const data = await response.json();
                    
                    if (response.status === 401) {
                        results.push(`‚úÖ ${endpoint} - Authentication required (correct behavior)`);
                        logResult(`API ${endpoint}`, 'Authentication working', 'success');
                    } else if (response.ok) {
                        results.push(`‚úÖ ${endpoint} - Success`);
                        logResult(`API ${endpoint}`, 'Success', 'success');
                    } else {
                        results.push(`‚ö†Ô∏è ${endpoint} - ${response.status}`);
                        logResult(`API ${endpoint}`, `Status ${response.status}`, 'warning');
                    }
                } catch (error) {
                    results.push(`‚ùå ${endpoint} - ${error.message}`);
                    logResult(`API ${endpoint}`, error.message, 'error');
                }
            }
            
            displayResult('api-results', results.join('<br>'), 'info');
        }

        async function testProfileApi() {
            try {
                const response = await fetch('/api/profile/');
                const data = await response.json();
                
                if (response.status === 401) {
                    displayResult('api-results', '‚úÖ Profile API authentication working correctly', 'success');
                    logResult('Profile API', 'Authentication working', 'success');
                } else {
                    displayResult('api-results', `‚úÖ Profile API responded with: ${JSON.stringify(data)}`, 'success');
                    logResult('Profile API', 'Success', 'success');
                }
            } catch (error) {
                displayResult('api-results', `‚ùå Profile API error: ${error.message}`, 'error');
                logResult('Profile API', error.message, 'error');
            }
        }

        async function testAchievementsApi() {
            try {
                const response = await fetch('/api/profile/achievements');
                const data = await response.json();
                
                if (response.status === 401) {
                    displayResult('api-results', '‚úÖ Achievements API authentication working correctly', 'success');
                    logResult('Achievements API', 'Authentication working', 'success');
                } else {
                    displayResult('api-results', `‚úÖ Achievements API responded with: ${JSON.stringify(data)}`, 'success');
                    logResult('Achievements API', 'Success', 'success');
                }
            } catch (error) {
                displayResult('api-results', `‚ùå Achievements API error: ${error.message}`, 'error');
                logResult('Achievements API', error.message, 'error');
            }
        }

        async function testStatsApi() {
            try {
                const response = await fetch('/api/profile/stats');
                const data = await response.json();
                
                if (response.status === 401) {
                    displayResult('api-results', '‚úÖ Stats API authentication working correctly', 'success');
                    logResult('Stats API', 'Authentication working', 'success');
                } else {
                    displayResult('api-results', `‚úÖ Stats API responded with: ${JSON.stringify(data)}`, 'success');
                    logResult('Stats API', 'Success', 'success');
                }
            } catch (error) {
                displayResult('api-results', `‚ùå Stats API error: ${error.message}`, 'error');
                logResult('Stats API', error.message, 'error');
            }
        }

        // Responsive Design Tests
        function testResponsiveDesign() {
            const viewport = document.querySelector('meta[name="viewport"]');
            const hasViewport = viewport && viewport.content.includes('width=device-width');
            
            if (hasViewport) {
                displayResult('responsive-results', '‚úÖ Responsive viewport meta tag found', 'success');
                logResult('Responsive Design', 'Viewport meta tag present', 'success');
            } else {
                displayResult('responsive-results', '‚ùå Responsive viewport meta tag missing', 'error');
                logResult('Responsive Design', 'Viewport meta tag missing', 'error');
            }
        }

        function simulateMobile() {
            document.body.style.width = '375px';
            document.body.style.margin = '0 auto';
            displayResult('responsive-results', 'üì± Mobile view simulated (375px width)', 'info');
            logResult('Mobile Simulation', 'Applied', 'info');
        }

        function simulateDesktop() {
            document.body.style.width = 'auto';
            document.body.style.margin = '0';
            displayResult('responsive-results', 'üñ•Ô∏è Desktop view restored', 'info');
            logResult('Desktop Simulation', 'Applied', 'info');
        }

        // Navigation Tests
        function testNavigationLinks() {
            const links = [
                { url: '/profile', name: 'Profile Page' },
                { url: '/dashboard', name: 'Dashboard' },
                { url: '/test_phase4_session1.html', name: 'Main Test Page' }
            ];
            
            let results = [];
            
            for (const link of links) {
                try {
                    // Test if link is reachable (simplified test)
                    results.push(`‚úÖ ${link.name} - Link available`);
                    logResult(`Navigation ${link.name}`, 'Link available', 'success');
                } catch (error) {
                    results.push(`‚ùå ${link.name} - ${error.message}`);
                    logResult(`Navigation ${link.name}`, error.message, 'error');
                }
            }
            
            displayResult('navigation-results', results.join('<br>'), 'info');
        }

        function openProfilePage() {
            window.open('/profile', '_blank');
            displayResult('navigation-results', '‚úÖ Profile page opened in new tab', 'success');
            logResult('Profile Page Navigation', 'Opened', 'success');
        }

        function openMainTest() {
            window.open('/test_phase4_session1.html', '_blank');
            displayResult('navigation-results', '‚úÖ Main test page opened in new tab', 'success');
            logResult('Main Test Page Navigation', 'Opened', 'success');
        }

        // Complete System Test
        async function runAllTests() {
            displayResult('complete-results', 'üöÄ Running comprehensive test suite...', 'info');
            
            // Component loading tests
            testComponentLoading();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // API tests
            await testApiEndpoints();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // Responsive design tests
            testResponsiveDesign();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // Navigation tests
            testNavigationLinks();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // Generate summary
            const totalTests = testResults.length;
            const successTests = testResults.filter(r => r.type === 'success').length;
            const errorTests = testResults.filter(r => r.type === 'error').length;
            const warningTests = testResults.filter(r => r.type === 'warning').length;
            
            const summary = `
                üìä Test Suite Complete<br>
                Total Tests: ${totalTests}<br>
                ‚úÖ Passed: ${successTests}<br>
                ‚ùå Failed: ${errorTests}<br>
                ‚ö†Ô∏è Warnings: ${warningTests}<br>
                üìà Success Rate: ${Math.round((successTests / totalTests) * 100)}%
            `;
            
            displayResult('complete-results', summary, 'info');
            logResult('Complete Test Suite', `${successTests}/${totalTests} passed`, 'success');
        }

        function generateTestReport() {
            const report = {
                timestamp: new Date().toISOString(),
                summary: {
                    totalTests: testResults.length,
                    passed: testResults.filter(r => r.type === 'success').length,
                    failed: testResults.filter(r => r.type === 'error').length,
                    warnings: testResults.filter(r => r.type === 'warning').length
                },
                details: testResults
            };
            
            const reportJson = JSON.stringify(report, null, 2);
            const blob = new Blob([reportJson], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `profile_system_test_report_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            
            URL.revokeObjectURL(url);
            
            displayResult('complete-results', '‚úÖ Test report generated and downloaded', 'success');
            logResult('Test Report', 'Generated', 'success');
        }

        // Initialize on page load
        window.addEventListener('load', function() {
            logResult('Page Load', 'Test suite initialized', 'info');
            console.log('üéØ Profile System Test Suite Ready');
            console.log('üìã Available tests:');
            console.log('  - Component Loading Tests');
            console.log('  - Achievement System Demo');
            console.log('  - Progress Visualization Demo');
            console.log('  - API Endpoint Tests');
            console.log('  - Responsive Design Tests');
            console.log('  - Navigation Tests');
            console.log('  - Complete System Tests');
        });
    </script>
</body>
</html>
