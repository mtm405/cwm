{% extends "base.html" %}
{% from "macros/dashboard.html" import stat_card, cached_stat_card, tab_button, progress_bar %}
{% from "macros/dashboard_modern.html" import render_leaderboard_item, render_daily_challenge, render_no_challenge, render_activity_item %}

{% block page_name %}dashboard{% endblock %}

{% block title %}Dashboard - Code with Morais{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Modern Header -->
    <header class="modern-dashboard-header">
        <div class="header-content">
            <div class="welcome-section">
                <h1 id="welcome-message">Welcome back! ðŸš€</h1>
                <p class="dashboard-subtitle">Ready to continue your Python journey?</p>
            </div>
            <div class="header-actions">
                <a href="/lessons" class="btn btn-primary"><i class="fas fa-book"></i> Continue Learning</a>
                <a href="#challenge" class="btn btn-outline" onclick="document.querySelector('[data-tab=challenge]').click()"><i class="fas fa-trophy"></i> Daily Challenge</a>
            </div>
        </div>
        
        <script>
            (function() {
                const welcomeMsg = document.getElementById('welcome-message');
                if (welcomeMsg) {
                    function getTimeBasedGreeting() {
                        const hour = new Date().getHours();
                        if (hour >= 5 && hour < 12) return 'Good morning';
                        if (hour >= 12 && hour < 17) return 'Good afternoon';
                        if (hour >= 17 && hour < 22) return 'Good evening';
                        return 'Good night';
                    }
                    const greeting = getTimeBasedGreeting();
                    const firstName = '{{ user.first_name or (user.display_name.split(" ")[0] if user.display_name else user.username) or "Guest" }}';
                    welcomeMsg.innerHTML = `${greeting}, ${firstName}! ðŸš€`;
                }
            })();
        </script>
        
        <nav class="dashboard-nav">
            <div class="nav-tabs-container">
                {{ tab_button('challenge', 'fas fa-bolt', 'Daily Challenge') }}
                {{ tab_button('overview', 'fas fa-chart-line', 'Overview', true) }}
                {{ tab_button('leaderboard', 'fas fa-trophy', 'Leaderboard') }}
                {{ tab_button('vocabulary', 'fas fa-book', 'Vocabulary') }}
                {{ tab_button('games', 'fas fa-gamepad', 'Games') }}
            </div>
            <button class="btn-refresh" aria-label="Refresh Dashboard">
                <i class="fas fa-sync-alt"></i>
            </button>
        </nav>
    </header>
    
    <!-- Tab Content Sections -->
    <div class="tab-content">
        
        <!-- Overview Tab -->
        <div class="tab-pane active" id="overview-tab">
            <div class="dashboard-main-grid">
                <!-- Left Column: Stats and other main content -->
                <div class="grid-col-span-2">
                    <!-- Modern Stats Cards -->
                    <div id="stats-content" class="stats-grid-modern">
                        {{ cached_stat_card(type='primary', icon='fas fa-star', value=user.get('xp', 0), label='Total XP', data_stat='xp', user_id=user.get('id', 'anonymous')) }}
                        {{ cached_stat_card(type='success', icon='fas fa-coins', value=user.get('pycoins', 0), label='PyCoins', data_stat='pycoins', user_id=user.get('id', 'anonymous')) }}
                        {{ cached_stat_card(type='warning', icon='fas fa-trophy', value=user.get('level', 1), label='Level', data_stat='level', user_id=user.get('id', 'anonymous')) }}
                        {{ cached_stat_card(type='info', icon='fas fa-fire', value=user.get('streak', 0), label='Day Streak', data_stat='streak', user_id=user.get('id', 'anonymous')) }}
                    </div>
                </div>

                <!-- Right Column: Activity Feed -->
                <div class="grid-col-span-1">
                    <div class="dashboard-card-modern activity-card-modern">
                        <div class="card-header-modern">
                            <h3><i class="fas fa-stream"></i> Recent Activity</h3>
                        </div>
                        <div class="card-body-modern no-padding">
                            <div class="activity-feed-modern">
                                <!-- JS will inject activity here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Challenge Tab -->
        <div class="tab-pane" id="challenge-tab">
            <div class="dashboard-card-modern challenge-card-modern">
                <div class="card-header-modern">
                    <h3><i class="fas fa-calendar-day"></i> Daily Challenge</h3>
                </div>
                <div class="card-body-modern">
                    {% if daily_challenge %}
                        {{ render_daily_challenge(daily_challenge) }}
                    {% else %}
                        {{ render_no_challenge() }}
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- Leaderboard Tab -->
        <div class="tab-pane" id="leaderboard-tab">
            {% include 'components/modals/leaderboard-modal.html' %}
        </div>

        <!-- Vocabulary Tab -->
        <div class="tab-pane" id="vocabulary-tab">
            <div class="placeholder-content">
                <i class="fas fa-book"></i>
                <h3>Vocabulary Section</h3>
                <p>This section is under construction. Come back soon for new ways to learn!</p>
            </div>
        </div>

        <!-- Games Tab -->
        <div class="tab-pane" id="games-tab">
            <div class="placeholder-content">
                <i class="fas fa-gamepad"></i>
                <h3>Games Section</h3>
                <p>This section is under construction. Exciting games are coming soon!</p>
            </div>
        </div>
        
    </div> <!-- End of tab-content -->
</div>

<!-- Dashboard-specific components -->
<script src="{{ url_for('static', filename='js/components/dashboard.js') }}"></script>
{% endblock %}
