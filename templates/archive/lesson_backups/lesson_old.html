{% extends "base.html" %}

{% block title %}{{ lesson.title if lesson else "Lesson" }} - Code with Morais{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/components/lesson.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/components/lesson-content-blocks.css') }}">
{% endblock %}

{% block content %}
<div class="lesson-container">
    <!-- LESSON HEADER SECTION -->
    <header class="lesson-header">
        {% include 'components/lesson/back-link.html' %}
        
        <div class="lesson-header-content">
            <div class="lesson-meta">
                <h1 class="lesson-title">
                    <i class="fas fa-{{ lesson.icon or 'code' }}"></i>
                    {{ lesson.title }}
                </h1>
                <div class="lesson-badges">
                    <span class="difficulty-badge {{ lesson.difficulty or 'beginner' }}">
                        {{ (lesson.difficulty or 'beginner')|title }}
                    </span>
                    <span class="time-badge">
                        <i class="fas fa-clock"></i> {{ lesson.estimated_time or 30 }}min
                    </span>
                    <span class="xp-badge">
                        <i class="fas fa-star"></i> {{ lesson.xp_reward or 100 }} XP
                    </span>
                </div>
            </div>
        </div>
    </header>

    <!-- LESSON CONTENT -->
    <div class="lesson-content" id="lesson-content">
        {% if lesson.content %}
            {% for content_block in lesson.content %}
                {% if content_block.type == 'text' %}
                    <div class="content-block text-block">
                        {{ content_block.content | markdown if content_block.content else 'No content available' }}
                    </div>
                {% elif content_block.type == 'code_example' %}
                    <div class="content-block code-block">
                        <div class="code-container">
                            <div class="code-header">
                                <span class="language-tag">{{ content_block.language or 'python' }}</span>
                                <button class="copy-btn" onclick="copyCode(this)">
                                    <i class="fas fa-copy"></i> Copy
                                </button>
                            </div>
                            <pre><code class="language-{{ content_block.language or 'python' }}">{{ content_block.code }}</code></pre>
                        </div>
                    </div>
                {% endif %}
            {% endfor %}
        {% else %}
            <div class="lesson-description">
                <p>{{ lesson.description or 'No content available for this lesson yet.' }}</p>
            </div>
        {% endif %}
        
        <!-- Progress Section -->
        {% if lesson.subtopics %}
            <div class="lesson-progress">
                <h3>Lesson Progress</h3>
                <div class="subtopics-list">
                    {% for subtopic in lesson.subtopics %}
                        <div class="subtopic-item" data-subtopic-id="{{ subtopic.id if subtopic.id else loop.index0 }}">
                            <div class="subtopic-content">
                                <i class="fas fa-circle-check progress-icon"></i>
                                <span class="subtopic-title">{{ subtopic.title if subtopic.title else subtopic }}</span>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- Load the simple lesson initialization script -->
<script src="{{ url_for('static', filename='js/components/simple-lesson-init.js') }}"></script>

<script>
// Pass lesson data to the simple lesson manager
window.lessonData = {{ lesson | tojson | safe if lesson else '{}' }};
console.log('ðŸ“š Lesson data passed to JavaScript:', window.lessonData);
</script>
{% endblock %}
