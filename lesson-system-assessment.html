<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson System Assessment</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        .info { background: #d1ecf1; color: #0c5460; }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        #console-output {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Lesson System Assessment</h1>
        <p>Testing the current state of the lesson system to identify what needs attention.</p>
        
        <div id="status" class="status info">
            Running assessment...
        </div>
        
        <div class="test-section">
            <h3>API Tests</h3>
            <button onclick="testAPI()">Test API Endpoints</button>
            <button onclick="testFirebaseConfig()">Test Firebase Config</button>
            <button onclick="testCodeExecution()">Test Code Execution</button>
        </div>
        
        <div class="test-section">
            <h3>Module Tests</h3>
            <button onclick="testModuleLoading()">Test Module Loading</button>
            <button onclick="testLessonSystem()">Test Lesson System</button>
            <button onclick="testQuizSystem()">Test Quiz System</button>
        </div>
        
        <div class="test-section">
            <h3>Console Output</h3>
            <div id="console-output"></div>
            <button onclick="clearConsole()">Clear Console</button>
        </div>
    </div>

    <script>
        const consoleOutput = document.getElementById('console-output');
        const statusDiv = document.getElementById('status');
        
        function logToConsole(message) {
            console.log(message);
            consoleOutput.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }
        
        function updateStatus(message, type = 'info') {
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }
        
        function clearConsole() {
            consoleOutput.textContent = '';
        }
        
        // Override console methods
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            logToConsole(args.join(' '));
        };
        
        const originalError = console.error;
        console.error = function(...args) {
            originalError.apply(console, args);
            logToConsole('ERROR: ' + args.join(' '));
        };
        
        const originalWarn = console.warn;
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            logToConsole('WARN: ' + args.join(' '));
        };
        
        // Test Functions
        async function testAPI() {
            logToConsole('üîç Testing API endpoints...');
            
            const endpoints = [
                '/api/lessons/python-basics-1',
                '/api/firebase-config',
                '/api/system-status'
            ];
            
            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(endpoint);
                    const data = await response.json();
                    logToConsole(`‚úÖ ${endpoint}: ${response.status} - ${JSON.stringify(data).substring(0, 100)}...`);
                } catch (error) {
                    logToConsole(`‚ùå ${endpoint}: ${error.message}`);
                }
            }
        }
        
        async function testFirebaseConfig() {
            logToConsole('üî• Testing Firebase configuration...');
            
            try {
                const response = await fetch('/api/firebase-config');
                const data = await response.json();
                
                if (data.error) {
                    logToConsole(`‚ùå Firebase config error: ${data.error}`);
                } else {
                    logToConsole(`‚úÖ Firebase config loaded`);
                    logToConsole(`Project ID: ${data.projectId}`);
                    logToConsole(`App ID: ${data.appId}`);
                    logToConsole(`Auth Domain: ${data.authDomain}`);
                }
            } catch (error) {
                logToConsole(`‚ùå Firebase config test failed: ${error.message}`);
            }
        }
        
        async function testCodeExecution() {
            logToConsole('üêç Testing code execution...');
            
            try {
                const response = await fetch('/api/execute', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        code: 'print("Hello, World!")',
                        language: 'python'
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    logToConsole(`‚úÖ Code execution working: ${data.output}`);
                } else {
                    logToConsole(`‚ùå Code execution failed: ${data.error}`);
                }
            } catch (error) {
                logToConsole(`‚ùå Code execution test failed: ${error.message}`);
            }
        }
        
        async function testModuleLoading() {
            logToConsole('üì¶ Testing module loading...');
            
            const modules = [
                '/static/js/lesson/lessonSystem.js',
                '/static/js/lesson/services/LessonDataService.js',
                '/static/js/lesson/services/LessonProgress.js',
                '/static/js/lesson/components/LessonRenderer.js',
                '/static/js/lesson/components/LessonInteractions.js'
            ];
            
            for (const moduleUrl of modules) {
                try {
                    const response = await fetch(moduleUrl);
                    if (response.ok) {
                        logToConsole(`‚úÖ Module available: ${moduleUrl}`);
                    } else {
                        logToConsole(`‚ùå Module not found: ${moduleUrl} (${response.status})`);
                    }
                } catch (error) {
                    logToConsole(`‚ùå Module test failed: ${moduleUrl} - ${error.message}`);
                }
            }
        }
        
        async function testLessonSystem() {
            logToConsole('üéì Testing lesson system...');
            
            try {
                // Try to import the lesson system
                const { LessonSystem } = await import('/static/js/lesson/lessonSystem.js');
                logToConsole('‚úÖ LessonSystem class imported successfully');
                
                // Try to create an instance
                const lessonSystem = new LessonSystem();
                logToConsole('‚úÖ LessonSystem instance created');
                
                // Test debug info
                const debugInfo = lessonSystem.getDebugInfo();
                logToConsole(`üìä Debug info: ${JSON.stringify(debugInfo, null, 2)}`);
                
            } catch (error) {
                logToConsole(`‚ùå Lesson system test failed: ${error.message}`);
            }
        }
        
        async function testQuizSystem() {
            logToConsole('üìù Testing quiz system...');
            
            try {
                const response = await fetch('/static/js/modules/quiz.js');
                if (response.ok) {
                    logToConsole('‚úÖ Quiz module file found');
                    // Try to load it
                    const script = document.createElement('script');
                    script.src = '/static/js/modules/quiz.js';
                    script.onload = () => {
                        logToConsole('‚úÖ Quiz module loaded successfully');
                        if (window.QuizModule) {
                            logToConsole('‚úÖ QuizModule class available');
                        } else {
                            logToConsole('‚ö†Ô∏è QuizModule class not found in global scope');
                        }
                    };
                    script.onerror = () => {
                        logToConsole('‚ùå Quiz module failed to load');
                    };
                    document.head.appendChild(script);
                } else {
                    logToConsole(`‚ùå Quiz module not found: ${response.status}`);
                }
            } catch (error) {
                logToConsole(`‚ùå Quiz system test failed: ${error.message}`);
            }
        }
        
        // Auto-run assessment
        window.addEventListener('load', async () => {
            logToConsole('üöÄ Starting lesson system assessment...');
            
            // Run all tests
            await testAPI();
            await testFirebaseConfig();
            await testCodeExecution();
            await testModuleLoading();
            await testLessonSystem();
            await testQuizSystem();
            
            logToConsole('‚úÖ Assessment complete! Check results above.');
            updateStatus('Assessment complete - check console output', 'success');
        });
    </script>
</body>
</html>
